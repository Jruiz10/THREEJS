<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - geometry - cube</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
  </head>
  <body>
    <!-- See main.css for #info and #overlay for the markup attributes for it -->
    <div id="info">Do you want to build a Snowman?</div>
    <!-- <div id="overlay">This is an overlay example.</div>  Uncomment if you want to see an overlay text --> 
    
    <script type="module">
      // ============================================================================
      // I find this option simpler than installing the entire three.module.js file
      import * as THREE from 'https://unpkg.com/three@0.128.0/build/three.module.js';
      // import * as THREE from '../build/three.module.js';
      // ============================================================================

      let camera, scene, renderer;   // The main three components
      let ballMesh;
      let snowman;
      let dz = 0.01;
      
      init();
      animate();

      function init() {
          // Create and set up the camera
	  camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
	  camera.position.z = 60;
          camera.position.y = 5.5;

          // Create and set up the Scene
	  scene = new THREE.Scene();

          // A simple snowman
          createSnowman(scene)

          // Set up lighting
          setupLighting(scene)
          
          // Create and set up the Renderer
	  renderer = new THREE.WebGLRenderer({ antialias: true });
	  renderer.setPixelRatio(window.devicePixelRatio);
	  renderer.setSize(window.innerWidth, window.innerHeight);
	  document.body.appendChild(renderer.domElement);

	  window.addEventListener( 'resize', onWindowResize );
      }

      function setupLighting(parent) {
          var x;
          for (x = -10; x <= 10; x += 5) {
              var lightColor = 0xffffcc
              var light = new THREE.PointLight( lightColor, 1, 100 );
              // var pos = new THREE.Vector3(x, 100, 5);
              light.position.set(x, 20, 0);
              parent.add(light);
              parent.add( new THREE.AmbientLight(0x111100) );
              
              // Make the light "visible"
              // Create the Sphere Geometry
              const geometry = new THREE.SphereGeometry(0.25, 10, 10);
              const mat = new THREE.MeshPhongMaterial( {
                  color: 0x000000,     // reflectivity for diffuse and ambient light
                  emissive: lightColor,  // emission color; a very small amount of red (in case my lighting is not working really)
                  specular: 0x000000,  // reflectivity for specular light
                  shininess: 1       // controls size of specular highlights
              } );
              var lightMesh = new THREE.Mesh( geometry, mat );
              lightMesh.position.set(x, 20, 0);
              parent.add(lightMesh);
          }
      }

      function createSnowman(parent) {
          // The holder for our snowman object
          snowman = new THREE.Object3D();

          // Set the material property for the ball
          const snowManMat = new THREE.MeshPhongMaterial( {
              color: 0x808080,     // reflectivity for diffuse and ambient light
              emissive: 0x200000,  // emission color; a very small amount of red (in case my lighting is not working really)
              specular: 0x828282,  // reflectivity for specular light
              shininess: 100       // controls size of specular highlights
          } );

          // Create the base of the snowman
          const baseGeometry = new THREE.SphereGeometry(3, 20, 20);
          const midGeometry = new THREE.SphereGeometry(2, 20, 20);
          const headGeometry = new THREE.SphereGeometry(1, 20, 20);

          const baseMesh = new THREE.Mesh(baseGeometry, snowManMat);
          const midMesh = new THREE.Mesh(midGeometry, snowManMat);
          const headMesh = new THREE.Mesh(headGeometry, snowManMat);

          snowman.add(baseMesh);
          baseMesh.position.y = 3;
          snowman.add(midMesh);
          midMesh.position.y = 8;
          snowman.add(headMesh);
          headMesh.position.y = 11;

          parent.add(snowman);
      }
      
      function createBall(parent) {
          // Create the Sphere Geometry
          const geometry = new THREE.SphereGeometry(50, 20, 20);

          // Set the material property for the ball
          const mat = new THREE.MeshPhongMaterial( {
              color: 0x808080,     // reflectivity for diffuse and ambient light
              emissive: 0x200000,  // emission color; a very small amount of red (in case my lighting is not working really)
              specular: 0x828282,  // reflectivity for specular light
              shininess: 100       // controls size of specular highlights
          } );
          
          // Create the mesh and add it to the scene
          //   We are making the ballMesh global so it can be altered by animation
          ballMesh = new THREE.Mesh( geometry, mat );
          parent.add(ballMesh);

      }

      // On a window resize, recompute the camera's aspect ratio and then update the project matrix based on that.
      function onWindowResize() {
	  camera.aspect = window.innerWidth / window.innerHeight;
	  camera.updateProjectionMatrix();

	  renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
	  requestAnimationFrame(animate);  // Request another call to animation frame (as soon as possible)

          // Rotate the mesh object in the x and y and z directions a bit.
	  snowman.rotation.z += dz;
          if (snowman.rotation.z < -0.5) {
              snowman.rotation.z = -0.5;
              dz = -dz;
          } else if (snowman.rotation.z > 0.5) {
              snowman.rotation.z = 0.5;
              dz = -dz;
          }

          // And now render the scene using the camera
          //    The renderer does all the set up and calling
	  renderer.render(scene, camera);
      }

    </script>

  </body>
</html>
